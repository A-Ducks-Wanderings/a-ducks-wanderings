{
	id: "charles",
	editor_info: {
		category: "player"
	},
	properties: {
		speed_x: { type: "decimal", default: 0.0, persistent: false },
		speed_y: { type: "decimal", default: 0.0, persistent: false },
		ctrl_run: { type: "bool", default: false, persistent: false },
		friction: { type: "decimal", default: 0.5, persistent: false },
		_key_state: { type: "{string -> bool}", default: {} },
	},

	on_end_stand_anim: "[
		set(animation, 'stand')
	]",

	on_end_walk_anim: "[
		set(animation, 'walk')
	]",

	on_process: "[
		map(ctrl_keys, 'key', [
			if(not key in _key_state, [
				set(_key_state[key], true),
				fire_event('ctrl_' + key)
			], [
				if(_key_state[key] = false, [
					set(_key_state[key], true),
					fire_event('ctrl_' + key)
				])
			])
        ]),
		map(keys(_key_state), 'key', [
			if(not key in ctrl_keys, [
				set(_key_state[key], false)
			])
		]),
		set(ctrl_run, ('d' in ctrl_keys)),
		if(is_standing and not animation in ['stand'], [
			set(animation, 'stand')
		]),
		if(animation in ['walk', 'stand'] and not is_standing, [
			add(speed_y, 2)
		]),
		set(speed_x, speed_x * friction),
		add(x, speed_x),
		add(y, speed_y),
		if(y > level.dimensions[3], [
			die()
		])
	]",

	on_process_stand: "[
		set(speed_y, 0),
		if((ctrl_left or ctrl_right) and not (animation in ['walk']), [
			set(animation, 'walk')
		]),
	]",

	on_process_walk: "[
		if(ctrl_left, [
			add(speed_x, -5)
		]),
		if(ctrl_right, [
			add(speed_x, 5)
		])
	]",

	animation: [
		{
			"@base": true,
			image: "characters/charles-spritesheet1.png",
			pad: 3,
			solid_area: [10, 4, 21, 30],
		},
		{
			id: "stand",
			rect: [2, 2, 33, 33],
			duration: 12,
			frames: 2,
		},
		{
			id: "walk",
			rect: [2, 72, 33, 103],
			duration: 4,
			frames: 4,
		},
	]
}