{
	id: "charles",
	editor_info: {
		category: "player"
	},
	properties: {
		speed_x: { type: "decimal", default: 0.0, persistent: false },
		speed_y: { type: "decimal", default: 0.0, persistent: false },
		ctrl_run: { type: "bool", default: false, persistent: false },
		_key_state: { type: "{string -> bool}", default: {} },
		accel: { type: "decimal", default: 1.0, persistent: false },
		friction_x: { type: "decimal", default: 0.8, persistent: false },
	},

	on_end_stand_anim: "[
		set(animation, 'stand')
	]",

	on_end_walk_anim: "[
		set(animation, 'walk')
	]",

	on_process: "[
		// key press event handler
		map(ctrl_keys, 'key', [
			if(not key in _key_state, [
				set(_key_state[key], true),
				fire_event('ctrl_' + key)
			], [
				if(_key_state[key] = false, [
					set(_key_state[key], true),
					fire_event('ctrl_' + key)
				])
			])
        ]),
		map(keys(_key_state), 'key', [
			if(not key in ctrl_keys, [
				set(_key_state[key], false)
			])
		]),
		set(ctrl_run, ('d' in ctrl_keys)),

		if((ctrl_left or ctrl_right) and animation in ['stand'], [
			set(animation, 'walk')
		]),
		
		// physics
		if(ctrl_left or ctrl_right, [
			set(facing, if(ctrl_left, -1, 1))
		]),
		add(speed_x, accel),

		if(is_standing, [
			set(speed_x, speed_x * friction_x),
		]),
		if(abs(speed_x) < 1, [
			set(speed_x, 0)
		]),
		if(abs(speed_y) < 1, [
			set(speed_y, 0)
		]),
		
		if(not is_standing, [
			set(speed_y, (speed_y + 1.5) * 0.94),
		]),
		debug(speed_y),
		debug(is_standing),
		add(x, speed_x),
		add(y, speed_y),

		if(y > level.dimensions[3], [
			die()
		]),
	]",

	on_process_walk: "if(not (ctrl_left or ctrl_right), [
		set(animation, 'stand')
	], [
		set(speed_x, if(ctrl_left, -1, 1) * 10)
	])",

	animation: [
		{
			"@base": true,
			image: "characters/charles-spritesheet1.png",
			pad: 3,
			solid_area: [10, 4, 21, 30],
		},
		{
			id: "stand",
			rect: [2, 2, 33, 33],
			duration: 12,
			frames: 2,
		},
		{
			id: "walk",
			rect: [2, 72, 33, 103],
			duration: 4,
			frames: 4
		},
	]
}